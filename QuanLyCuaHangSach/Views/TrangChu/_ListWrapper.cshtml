@model IEnumerable<QuanLyCuaHangSach.Models.Sach>
@{

    int pageNumber = ViewBag.PageNumber;
    int totalPages = ViewBag.TotalPages;
    string searchString = ViewBag.SearchString as string;
    int? theLoaiId = ViewBag.CurrentTheLoaiId as int?;
    var maTaiKhoan = Context.Session.GetInt32("MaTaiKhoan");
    bool isLoggedIn = maTaiKhoan != null;
}

<!-- Bắt đầu wrapper -->
<div id="listWrapper">
    <!-- Danh sách sách -->
    <div id="danhSachSach" class="row">
        @foreach (var sach in Model)
        {
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm"
                     style="border-radius: 8px;
                            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                            overflow: hidden;
                            background-color: #fff8f0;
                            display: flex;
                            flex-direction: column;">
                    <div class="row g-0">
                        <div class="col-4 d-flex align-items-center">
                            <img src="@Url.Content(!string.IsNullOrEmpty(sach.HinhAnh) && sach.HinhAnh.StartsWith("/images/")
                                             ? sach.HinhAnh
                                             : "~/images/sach/default.jpg")"
                                 class="img-fluid rounded-start"
                                 alt="@sach.TieuDe"
                                 style="height: 100%; object-fit: cover; border-radius: 8px 0 0 8px;" />
                        </div>
                        <div class="col-8 d-flex flex-column">
                            <div class="card-body" style="padding: 15px; flex-grow: 1;">
                                <h5 class="card-title"
                                    style="font-size: 1.1rem;
                                           font-weight: bold;
                                           color: #8b4513;
                                           white-space: nowrap;
                                           overflow: hidden;
                                           text-overflow: ellipsis;">
                                    @sach.TieuDe
                                </h5>
                                <p class="card-text"
                                   style="font-size: 1rem;
                                          color: #6e4b3b;
                                          overflow: hidden;
                                          text-overflow: ellipsis;
                                          white-space: nowrap;">
                                    <strong>Giá:</strong> @sach.Gia.ToString("N0") VNĐ
                                </p>
                                <p class="card-text"
                                   style="font-size: 1rem;
                                          color: #6e4b3b;
                                          overflow: hidden;
                                          text-overflow: ellipsis;
                                          white-space: nowrap;">
                                    <strong>Thể loại:</strong> @sach.TheLoai?.TenTheLoai
                                </p>
                                <p class="card-text"
                                   style="font-size: 1rem;
                                          color: #6e4b3b;
                                          overflow: hidden;
                                          text-overflow: ellipsis;
                                          white-space: nowrap;">
                                    <strong>Đã mượn:</strong> @sach.SoLuongMuon cuốn
                                </p>
                                <p class="card-text"
                                   style="font-size: 1rem;
                                          color: #6e4b3b;
                                          overflow: hidden;
                                          text-overflow: ellipsis;
                                          white-space: nowrap;">
                                    <strong>Đã bán:</strong> @sach.SoLuongBan cuốn
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center gap-3 mt-3"
                         style="display: flex; gap: 10px;">
                        <button type="button"
                                class="btn"
                                onclick="themVaoGio(@sach.MaSach)"
                                style="border-radius: 5px;
                                       padding: 8px 16px;
                                       font-size: 1rem;
                                       font-weight: bold;
                                       background-color: #8b4513;
                                       color: white;
                                       border: none;">
                            Thêm vào giỏ
                        </button>
                        <span>
                            <button type="button"
                            @(isLoggedIn ? "" : "disabled")
                                    data-bs-toggle="modal"
                                    data-bs-target="#xacNhanModal"
                                    onclick="prepareDatThue(@sach.MaSach)"
                                    style="border-radius:5px; padding:8px 16px; font-size:1rem; font-weight:bold;
                   background-color:@(isLoggedIn ? "#8b4513" : "#ccc");
                   color:white; border:none;
                   cursor:@(isLoggedIn ? "pointer" : "not-allowed");">
                                📚 Đặt thuê
                            </button>
                        </span>

                    </div>
                </div>
            </div>
        }
    </div>
    <script>
        // Khởi tạo tooltip sau khi tải trang xong
        document.addEventListener('DOMContentLoaded', function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>

    <!-- Phân trang -->
    <div id="pagination" class="d-flex justify-content-center mt-4">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                @if (pageNumber > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="javascript:;" data-page="1">Đầu</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="javascript:;" data-page="@(pageNumber - 1)">Trước</a>
                    </li>
                }
                @for (int i = 1; i <= totalPages; i++)
                {
                    <li class="page-item @(i == pageNumber ? "active" : "")">
                        <a class="page-link" href="javascript:;" data-page="@i">@i</a>
                    </li>
                }
                @if (pageNumber < totalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="javascript:;" data-page="@(pageNumber + 1)">Tiếp</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="javascript:;" data-page="@totalPages">Cuối</a>
                    </li>
                }
            </ul>
        </nav>
    </div>
</div>


